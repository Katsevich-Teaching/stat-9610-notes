<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT 9610 Lecture Notes - 5&nbsp; Collinearity and adjustment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./r-demo-part-1.html" rel="next">
<link href="./anova.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./linear-models-estimation.html">Linear models: Estimation</a></li><li class="breadcrumb-item"><a href="./collinearity.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Collinearity and adjustment</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAT 9610 Lecture Notes</a> 
        <div class="sidebar-tools-main">
    <a href="./STAT-9610-Lecture-Notes.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./linear-models-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear models: Estimation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interpreting-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Interpreting linear models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./least-squares-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Least squares estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anova.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Analysis of variance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collinearity.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Collinearity and adjustment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-demo-part-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R demo</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./linear-models-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear models: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./building-blocks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building blocks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hypothesis-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hypothesis testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Power</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./confidence-intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Confidence intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./practical-considerations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Practical considerations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-demo-part-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">R demo</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./linear-models-misspecification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear models: Misspecification</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misspecification-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./asymptotic-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asymptotic methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bootstrap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The bootstrap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./permutation-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The permutation test</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robust-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Robust estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-demo-part-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">R demo</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glm-general-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized linear models: General theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exponential-dispersion-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Exponential dispersion model (EDM) distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalized-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">GLM definition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parameter-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Parameter estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glm-inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Inference in GLMs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-demo-part-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">R demo</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glm-special-cases.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized linear models: Special cases</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Logistic regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./poisson-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Poisson regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./negative-binomial-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Negative binomial regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-demo-part-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">R demo</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./multiple-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple-testing-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./global-testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Global testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple-testing-chapter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Multiple testing</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#least-squares-estimates-in-the-orthogonal-case" id="toc-least-squares-estimates-in-the-orthogonal-case" class="nav-link active" data-scroll-target="#least-squares-estimates-in-the-orthogonal-case"><span class="header-section-number">5.1</span> Least squares estimates in the orthogonal case</a></li>
  <li><a href="#least-squares-estimates-via-orthogonalization" id="toc-least-squares-estimates-via-orthogonalization" class="nav-link" data-scroll-target="#least-squares-estimates-via-orthogonalization"><span class="header-section-number">5.2</span> Least squares estimates via orthogonalization</a></li>
  <li><a href="#adjustment-and-partial-correlation" id="toc-adjustment-and-partial-correlation" class="nav-link" data-scroll-target="#adjustment-and-partial-correlation"><span class="header-section-number">5.3</span> Adjustment and partial correlation</a></li>
  <li><a href="#effects-of-collinearity" id="toc-effects-of-collinearity" class="nav-link" data-scroll-target="#effects-of-collinearity"><span class="header-section-number">5.4</span> Effects of collinearity</a></li>
  <li><a href="#remark-average-treatment-effect-estimation-in-causal-inference" id="toc-remark-average-treatment-effect-estimation-in-causal-inference" class="nav-link" data-scroll-target="#remark-average-treatment-effect-estimation-in-causal-inference"><span class="header-section-number">5.5</span> Remark: Average treatment effect estimation in causal inference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-collinearity" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Collinearity and adjustment</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><em>See also Agresti 2.2.4, 2.5.6, 2.5.7, 4.6.5</em></p>
<p>An important part of linear regression analysis is the dependence of the least squares coefficient for a predictor (<span class="math inline">\(x_j\)</span>) on what other predictors are in the model <span class="math inline">\((\boldsymbol x_{\text{-}j})\)</span>. This relationship is dictated by the extent to which <span class="math inline">\(\boldsymbol x_{*j}\)</span> is correlated with <span class="math inline">\(\boldsymbol X_{*,\text{-}j}\)</span>. To explore this phenomenon, it will be useful to compare two different regressions:</p>
<ul>
<li>Regress <span class="math inline">\(\boldsymbol y\)</span> on <em>just</em> <span class="math inline">\(\boldsymbol{x}_{*j}\)</span>. Let the resulting coefficient for <span class="math inline">\(x_j\)</span> be <span class="math inline">\(\widehat{\beta}_j\)</span>.</li>
<li>Regress <span class="math inline">\(\boldsymbol y\)</span> on <em>all of</em> <span class="math inline">\(\boldsymbol X\)</span> (i.e., on both <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> and <span class="math inline">\(\boldsymbol X_{*, \text{-}j}\)</span>). Let the resulting coefficients for <span class="math inline">\(x_j\)</span> and <span class="math inline">\(\boldsymbol x_{\text{-}j}\)</span> be <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span> and <span class="math inline">\(\widehat{\beta}_{\text{-}j|j}\)</span>, respectively.</li>
</ul>
<section id="least-squares-estimates-in-the-orthogonal-case" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="least-squares-estimates-in-the-orthogonal-case"><span class="header-section-number">5.1</span> Least squares estimates in the orthogonal case</h2>
<p>The simplest case to analyze is when <span class="math inline">\(\boldsymbol x_{*j}\)</span> is orthogonal to <span class="math inline">\(\boldsymbol X_{*,\text{-}j}\)</span> in the sense that</p>
<p><span id="eq-orthogonality-assumption"><span class="math display">\[
\boldsymbol x_{*j}^T \boldsymbol X_{*,\text{-}j} = \boldsymbol{0}.
\tag{5.1}\]</span></span></p>
<p>In this case, we can derive the least squares coefficient vector <span class="math inline">\(\boldsymbol{\widehat{\beta}} = (\widehat{\beta}_{j|\text{-}j}, \boldsymbol{\widehat{\beta}}_{\text{-}j|j})\)</span> in the regression of <span class="math inline">\(\boldsymbol y\)</span> on <span class="math inline">\(\boldsymbol X\)</span>:</p>
<p><span id="eq-orthogonality"><span class="math display">\[
\begin{split}
\begin{pmatrix}
\widehat{\beta}_{j|\text{-}j} \\
\boldsymbol{\widehat{\beta}}_{\text{-}j|j}
\end{pmatrix} &amp;= (\boldsymbol{X}^T \boldsymbol{X})^{-1} \boldsymbol{X}^T \boldsymbol{y} \\
&amp;=
\begin{pmatrix}
\boldsymbol x_{*j}^T \boldsymbol x_{*j} &amp; \boldsymbol{0} \\
\boldsymbol{0} &amp; \boldsymbol{X}_{*,\text{-}j}^T \boldsymbol{X}_{*,\text{-}j}
\end{pmatrix}^{-1}
\begin{pmatrix}
\boldsymbol x_{*j}^T \\
\boldsymbol{X}_{*,\text{-}j}^T
\end{pmatrix} \boldsymbol{y} \\
&amp;=
\begin{pmatrix}
(\boldsymbol x_{*j}^T \boldsymbol x_{*j})^{-1} \boldsymbol x_{*j}^T \boldsymbol{y} \\
(\boldsymbol{X}_{*,\text{-}j}^T \boldsymbol{X}_{*,\text{-}j})^{-1} \boldsymbol{X}_{*,\text{-}j}^T \boldsymbol{y}
\end{pmatrix} \\
&amp;=
\begin{pmatrix}
\widehat{\beta}_{j} \\
\boldsymbol{\widehat{\beta}}_{\text{-}j}
\end{pmatrix}.
\end{split}
\tag{5.2}\]</span></span></p>
<p>Therefore, the least squares coefficient of <span class="math inline">\(x_j\)</span> is the same regardless of whether the other predictors are included in the regression, i.e.</p>
<p><span id="eq-orthogonality-consequence"><span class="math display">\[
\widehat{\beta}_{j|\text{-}j} = \widehat{\beta}_{j}.
\tag{5.3}\]</span></span></p>
</section>
<section id="least-squares-estimates-via-orthogonalization" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="least-squares-estimates-via-orthogonalization"><span class="header-section-number">5.2</span> Least squares estimates via orthogonalization</h2>
<p>The orthogonality assumption (<a href="#eq-orthogonality-assumption"><span>5.1</span></a>) is almost never satisfied in practice. Usually, <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> has a nonzero projection <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\boldsymbol{\widehat{\gamma}}\)</span> onto <span class="math inline">\(C(\boldsymbol{X}_{*,\text{-}j})\)</span>:</p>
<p><span class="math display">\[
\boldsymbol{x}_{*j} = \boldsymbol{X}_{*,\text{-}j}\boldsymbol{\widehat{\gamma}} + \boldsymbol{x}^{\perp}_{*j},
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{x}^{\perp}_{*j}\)</span> is the residual from regressing <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> onto <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span> and is therefore orthogonal to <span class="math inline">\(C(\boldsymbol{X}_{*,\text{-}j})\)</span>. In other words, <span class="math inline">\(\boldsymbol{x}^{\perp}_{*j}\)</span> is the projection of <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> onto the orthogonal complement of <span class="math inline">\(C(\boldsymbol{X}_{*,\text{-}j})\)</span>. Another way of framing this relationship is that <span class="math inline">\(\boldsymbol{x}^{\perp}_{*j}\)</span> is the result of <em>adjusting</em> <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> for <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span>.</p>
<p>With this decomposition, let us change basis from <span class="math inline">\((\boldsymbol{x}_{*j}, \boldsymbol{X}_{*,\text{-}j})\)</span> to <span class="math inline">\((\boldsymbol{x}^{\perp}_{*j}, \boldsymbol{X}_{*,\text{-}j})\)</span> by the process explored in Homework 1 Question 1. Let us write:</p>
<p><span class="math display">\[
\begin{aligned}
\boldsymbol{y} &amp;= \boldsymbol{x}_{*j} \beta_{j|\text{-}j} + \boldsymbol{X}_{*,\text{-}j}\boldsymbol{\beta}_{\text{-}j|j} + \boldsymbol{\epsilon} \\
&amp;\Longleftrightarrow \ \boldsymbol{y} = (\boldsymbol{X}_{*,\text{-}j}\boldsymbol{\widehat{\gamma}} + \boldsymbol{x}^{\perp}_{*j})\beta_{j|\text{-}j} + \boldsymbol{X}_{*,\text{-}j}\boldsymbol{\beta}_{\text{-}j|j} + \boldsymbol{\epsilon} \\
&amp;\Longleftrightarrow \ \boldsymbol{y} = \boldsymbol{x}^{\perp}_{*j}\beta_{j|\text{-}j} + \boldsymbol{X}_{*,\text{-}j}\boldsymbol{\beta}'_{\text{-}j|j} + \boldsymbol{\epsilon}.
\end{aligned}
\]</span></p>
<p>What this means is that <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span>, the least squares coefficient of <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> in the regression of <span class="math inline">\(\boldsymbol{y}\)</span> on <span class="math inline">\((\boldsymbol{x}_{*j}, \boldsymbol{X}_{*,\text{-}j})\)</span>, is also the least squares coefficient of <span class="math inline">\(\boldsymbol{x}^{\perp}_{*j}\)</span> in the regression of <span class="math inline">\(\boldsymbol{y}\)</span> on <span class="math inline">\((\boldsymbol{x}^{\perp}_{*j}, \boldsymbol{X}_{*,\text{-}j})\)</span>. However, since <span class="math inline">\(\boldsymbol{x}^{\perp}_{*j}\)</span> is orthogonal to <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span> by construction, we can use the result (<a href="#eq-orthogonality"><span>5.2</span></a>) to conclude that:</p>
<p><span class="math display">\[
\widehat{\beta}_{j|\text{-}j} \text{ is the least squares coefficient of } \boldsymbol{x}^{\perp}_{*j} \text{ in the } \textit{univariate} \text{ regression of } \boldsymbol{y} \text{ on } \boldsymbol{x}^{\perp}_{*j}.
\]</span></p>
<p>We can solve this univariate regression explicitly to obtain:</p>
<p><span id="eq-orthogonal-univariate"><span class="math display">\[
\widehat{\beta}_{j|\text{-}j} = \frac{(\boldsymbol{x}^{\perp}_{*j})^T \boldsymbol{y}}{\|\boldsymbol{x}^{\perp}_{*j}\|^2}.
\tag{5.4}\]</span></span></p>
</section>
<section id="adjustment-and-partial-correlation" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="adjustment-and-partial-correlation"><span class="header-section-number">5.3</span> Adjustment and partial correlation</h2>
<p>Equivalently, letting <span class="math inline">\(\boldsymbol{\widehat{\beta}}_{\text{-}j}\)</span> be the least squares estimate in the regression of <span class="math inline">\(\boldsymbol{y}\)</span> on <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span> (note that this is <em>not</em> the same as <span class="math inline">\(\boldsymbol{\widehat{\beta}}_{\text{-}j|j}\)</span>), we can write:</p>
<p><span class="math display">\[
\widehat{\beta}_{j|\text{-}j} = \frac{(\boldsymbol{x}^{\perp}_{*j})^T(\boldsymbol{y} - \boldsymbol{X}_{*,\text{-}j}\boldsymbol{\widehat{\beta}}_{\text{-}j})}{\|\boldsymbol{x}^{\perp}_{*j}\|^2} \equiv \frac{(\boldsymbol{x}^{\perp}_{*j})^T \boldsymbol y^\perp}{\|\boldsymbol{x}^{\perp}_{*j}\|^2}.
\]</span></p>
<p>We can interpret this result as follows:</p>
<div id="thm-frisch-waugh-lovell" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5.1 </strong></span>The linear regression coefficient <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span> results from first adjusting <span class="math inline">\(\boldsymbol{y}\)</span> and <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> for the effects of all other variables, and then regressing the residuals from <span class="math inline">\(\boldsymbol{y}\)</span> onto the residuals from <span class="math inline">\(\boldsymbol{x}_{*j}\)</span>.</p>
</div>
<p>In this sense, <em>the least squares coefficient for a predictor in a multiple linear regression reflects the effect of the predictor on the response after controlling for the effects of all other predictors.</em></p>
<p>Econometricians calls this the Frisch-Waugh-Lovell (FWL) theorem, to acknowledge economists Ragnar Frisch and Frederick V. Waugh, who first derived the result in 1933, and Michael C. Lovell, who later rediscovered and extended it in 1963. In the statistical literature, this fact was known at least as early as 1907, when Yule documented it in his paper “On the Theory of Correlation for any Number of Variables, treated by a New System of Notation.”</p>
<p>A related quantity is the <em>partial correlation</em> between <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> and <span class="math inline">\(\boldsymbol{y}\)</span> after controlling for <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span>, defined as the empirical correlation between <span class="math inline">\(\boldsymbol{x}_{*j}^\perp\)</span> and <span class="math inline">\(\boldsymbol{y}^\perp\)</span>: <span class="math display">\[
\rho(\boldsymbol{x}_{*j}, \boldsymbol{y}|\boldsymbol{X}_{*,\text{-}j}) \equiv \frac{(\boldsymbol{x}_{*j}^\perp)^T(\boldsymbol{y}^\perp)}{\|\boldsymbol{x}_{*j}^\perp\| \|\boldsymbol{y}^\perp\|}.
\]</span> We can then connect the least squares coefficient <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span> to this partial correlation: <span class="math display">\[
\widehat{\beta}_{j|\text{-}j} = \frac{(\boldsymbol{x}^{\perp}_{*j})^T \boldsymbol y^\perp}{\|\boldsymbol{x}^{\perp}_{*j}\|^2} = \frac{\|\boldsymbol{y}^\perp\|}{\|\boldsymbol{x}_{*j}^\perp\|}\rho(\boldsymbol{x}_{*j}, \boldsymbol{y}|\boldsymbol{X}_{*,\text{-}j}),
\]</span></p>
<p>in a similar spirit to equation (<a href="anova.html#eq-beta1-simple-linear-regression"><span>4.5</span></a>).</p>
</section>
<section id="effects-of-collinearity" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="effects-of-collinearity"><span class="header-section-number">5.4</span> Effects of collinearity</h2>
<p>Collinearity between a predictor <span class="math inline">\(x_j\)</span> and the other predictors tends to make the estimate <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span> unstable. Intuitively, this makes sense because it becomes harder to distinguish between the effects of predictor <span class="math inline">\(x_j\)</span> and those of the other predictors on the response. To find the variance of <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span> for a model matrix <span class="math inline">\(\boldsymbol{X}\)</span>, we could in principle use the formula (<a href="least-squares-estimation.html#eq-var-of-beta-hat"><span>3.3</span></a>). However, this formula involves the inverse of the matrix <span class="math inline">\(\boldsymbol{X}^T \boldsymbol{X}\)</span>, which is hard to reason about. Instead, we can employ the formula (<a href="#eq-orthogonal-univariate"><span>5.4</span></a>) to calculate directly that:</p>
<p><span id="eq-conditional-variance"><span class="math display">\[
\text{Var}[\widehat{\beta}_{j|\text{-}j}] = \frac{\sigma^2}{\|\boldsymbol{x}_{*j}^\perp\|^2}.
\tag{5.5}\]</span></span></p>
<p>We see that the variance of <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span> is inversely proportional to <span class="math inline">\(\|\boldsymbol{x}_{*j}^\perp\|^2\)</span>. This means that the greater the collinearity, the less of <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> is left over after adjusting for <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span>, and the greater the variance of <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span>. To quantify the effect of this adjustment, suppose there were no other predictors other than the intercept term. Then, we would have:</p>
<p><span class="math display">\[
\text{Var}[\widehat{\beta}_{j|1}] = \frac{\sigma^2}{\|\boldsymbol{x}_{*j}-\bar{x}_j \boldsymbol{1}_n\|^2}.
\]</span></p>
<p>Therefore, we can rewrite the variance (<a href="#eq-conditional-variance"><span>5.5</span></a>) as:</p>
<p><span id="eq-vif"><span class="math display">\[
\text{Var}[\widehat{\beta}_{j|\text{-}j}] = \frac{\|\boldsymbol{x}_{*j}-\bar{x}_j \boldsymbol{1}_n\|^2}{\|\boldsymbol{x}_{*j}-\boldsymbol{X}_{*,\text{-}j}\boldsymbol{\widehat{\gamma}}\|^2} \cdot \text{Var}[\widehat{\beta}_{j|1}] = \frac{1}{1-R_j^2} \cdot \text{Var}[\widehat{\beta}_{j|1}] \equiv \text{VIF}_j \cdot \text{Var}[\widehat{\beta}_{j|1}],
\tag{5.6}\]</span></span></p>
<p>where <span class="math inline">\(R_j^2\)</span> is the <span class="math inline">\(R^2\)</span> value when regressing <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> on <span class="math inline">\(\boldsymbol{X}_{*,\text{-}j}\)</span> and VIF stands for <em>variance inflation factor</em>. The higher <span class="math inline">\(R_j^2\)</span>, the more of the variance in <span class="math inline">\(\boldsymbol{x}_{*j}\)</span> is explained by other predictors, the higher the variance in <span class="math inline">\(\widehat{\beta}_{j|\text{-}j}\)</span>.</p>
</section>
<section id="remark-average-treatment-effect-estimation-in-causal-inference" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="remark-average-treatment-effect-estimation-in-causal-inference"><span class="header-section-number">5.5</span> Remark: Average treatment effect estimation in causal inference</h2>
<p>Suppose we’d like to study the effect of an exposure or treatment (e.g.&nbsp;taking a blood pressure medication) on a response <span class="math inline">\(y\)</span> (e.g.&nbsp;blood pressure). In the Neyman-Rubin causal model, for a given individual <span class="math inline">\(i\)</span> we denote by <span class="math inline">\(y_i(1)\)</span> and <span class="math inline">\(y_i(0)\)</span> the outcomes that would have occurred had the individual received the treatment and the control, respectively. These are called <em>potential outcomes</em>. Let <span class="math inline">\(t_i \in \{0,1\}\)</span> indicate whether the <span class="math inline">\(i\)</span>th individual actually received treatment or control. Therefore, the observed outcome is<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span id="eq-sutva"><span class="math display">\[
y_i^{\text{obs}} = y_i(t_i).
\tag{5.7}\]</span></span> Based on the data <span class="math inline">\(\{(t_i, y_i^{\text{obs}})\}_{i = 1, \dots, n}\)</span>, the most basic goal is to estimate the</p>
<p><span class="math display">\[
\textit{average treatment effect} \  \tau \equiv \mathbb{E}[y(1) - y(0)],
\]</span></p>
<p>where averaging is done over the population of individuals (often called <em>units</em> in causal inference). Of course, we do not observe both <span class="math inline">\(y_i(1)\)</span> and <span class="math inline">\(y_i(0)\)</span> for any unit <span class="math inline">\(i\)</span>. Additionally, usually in observational studies we have <em>confounding variables</em> <span class="math inline">\(w_2, \dots, w_{p-1}\)</span>: variables that influence both the treatment assignment and the response (e.g.&nbsp;degree of health-seeking activity). It is important to control for these confounders in order to get an unbiased estimate of the treatment effect. Suppose the following linear model holds:</p>
<p><span class="math display">\[
y(t) = \beta_0 + \beta_1 t + \beta_2 w_2 + \cdots + \beta_{p-1} w_{p-1} + \epsilon \quad \text{for } t \in \{0, 1\}, \quad \text{where} \ \epsilon \perp\!\!\!\perp t.
\]</span></p>
<p>This assumption can be broken down into the following statements:</p>
<ul>
<li>the treatment effect is constant across units;</li>
<li>the response is a linear function of the treatment and observed confounders;</li>
<li>there is no unmeasured confounding.</li>
</ul>
<p>Under these assumptions, we find that</p>
<p><span class="math display">\[
\tau \equiv \mathbb{E}[y(1) - y(0)] = \beta_1.
\]</span></p>
<p>Using the relationship (<a href="#eq-sutva"><span>5.7</span></a>), we find that</p>
<p><span class="math display">\[
y^{\text{obs}} = \beta_0 + \beta_1 t + \beta_2 w_2 + \cdots + \beta_{p-1} w_{p-1} + \epsilon \quad \text{for } t \in \{0, 1\}.
\]</span></p>
<p>In this case, the average treatment effect <span class="math inline">\(\tau\)</span> is <em>identified</em> as the coefficient <span class="math inline">\(\beta_1\)</span> in the above regression, i.e.&nbsp;<span class="math inline">\(\tau = \beta_1\)</span>. In other words, the causal parameter coincides with a parameter of the statistical model for the observed data. Therefore, the least squares estimate <span class="math inline">\(\widehat{\beta}_1\)</span> is an unbiased estimate of the average treatment effect.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Causal inference is a vast field, which lies mostly beyond the scope of STAT 9610; see STAT 9210 instead.</p>
</div>
</div>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This requires the <em>stable unit treatment value assumption</em> (SUTVA), which prevents issues like <em>interference</em>, where the treatment of individual <span class="math inline">\(i\)</span> can be affected by the assigned treatments of other individuals.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./anova.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Analysis of variance</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./r-demo-part-1.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R demo</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>